<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImaLink - Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="mobile-nav-toggle" onclick="toggleSidebar()">‚ò∞</button>

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="logo">
            <h2>üì∏ ImaLink</h2>
            <p>Bildeh√•ndtering</p>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/" class="nav-link active">
                    <span class="nav-icon">üè†</span>
                    Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a href="/gallery" class="nav-link">
                    <span class="nav-icon">üñºÔ∏è</span>
                    Bildegalleri
                </a>
            </li>
            <li class="nav-item">
                <a href="/selections" class="nav-link">
                    <span class="nav-icon">üìÅ</span>
                    Selections
                </a>
            </li>
            <li class="nav-item">
                <a href="/import" class="nav-link">
                    <span class="nav-icon">üì•</span>
                    Import
                </a>
            </li>
            <li class="nav-item">
                <a href="/authors" class="nav-link">
                    <span class="nav-icon">üë•</span>
                    Fotografer
                </a>
            </li>

        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Hero Section -->
            <section class="section text-center mb-4">
                <h1>üì∏ Velkommen til ImaLink</h1>
                <p>Administrer og organiser dine bilder enkelt</p>
            </section>

            <!-- Dashboard Cards -->
            <div class="grid grid-2 mb-4">
                <a href="/gallery" class="card">
                    <div class="card-icon">üñºÔ∏è</div>
                    <h3>Bildegalleri</h3>
                    <p>Bla gjennom og administrer dine bilder</p>
                </a>

                <a href="/import" class="card">
                    <div class="card-icon">üì•</div>
                    <h3>Import Bilder</h3>
                    <p>Last opp nye bilder til galleriet</p>
                </a>

                <a href="/authors" class="card">
                    <div class="card-icon">üë•</div>
                    <h3>Fotografer</h3>
                    <p>Administrer fotografer og opphavsrett</p>
                </a>


            </div>

            <!-- Quick Stats -->
            <div class="section">
                <h2>üìä Statistikk</h2>
                <div class="grid grid-4" id="statsGrid">
                    <div class="stat-item">
                        <span class="stat-number" id="totalImages">-</span>
                        <span class="stat-label">Totale Bilder</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalAuthors">-</span>
                        <span class="stat-label">Fotografer</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalSize">-</span>
                        <span class="stat-label">Total St√∏rrelse</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="recentImages">-</span>
                        <span class="stat-label">Siste 30 dager</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.querySelector('.mobile-nav-toggle');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !toggle.contains(event.target)) {
                sidebar.classList.remove('open');
            }
        });

        // Load dashboard statistics
        async function loadStats() {
            try {
                // Load total images
                const imagesResponse = await fetch('/api/images');
                const images = await imagesResponse.json();
                document.getElementById('totalImages').textContent = images.length;

                // Load authors
                const authorsResponse = await fetch('/api/authors');
                const authors = await authorsResponse.json();
                document.getElementById('totalAuthors').textContent = authors.length;

                // Calculate total size (simplified)
                let totalSize = 0;
                for (const image of images) {
                    totalSize += image.file_size || 0;
                }
                
                const sizeMB = (totalSize / (1024 * 1024)).toFixed(1);
                document.getElementById('totalSize').textContent = `${sizeMB} MB`;

                // Count recent images (last 30 days)
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                const recentCount = images.filter(img => {
                    return img.created_at && new Date(img.created_at) > thirtyDaysAgo;
                }).length;
                
                document.getElementById('recentImages').textContent = recentCount;

            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('totalImages').textContent = 'N/A';
                document.getElementById('totalAuthors').textContent = 'N/A';
                document.getElementById('totalSize').textContent = 'N/A';
                document.getElementById('recentImages').textContent = 'N/A';
            }
        }

        // Load stats when page loads
        document.addEventListener('DOMContentLoaded', loadStats);
    </script>
</body>
</html>