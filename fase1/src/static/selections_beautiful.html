<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selections - ImaLink</title>
    <link rel="stylesheet" href="/static/styles.css?v=2000">
</head>
<body>
    <!-- Mobile Navigation Toggle -->
    <button class="mobile-nav-toggle" onclick="toggleSidebar()">â˜°</button>

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="logo">
            <h2>ğŸ“¸ ImaLink</h2>
            <p>BildehÃ¥ndtering</p>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/" class="nav-link">
                    <span class="nav-icon">ğŸ </span>
                    Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a href="/gallery" class="nav-link">
                    <span class="nav-icon">ğŸ–¼ï¸</span>
                    Bildegalleri
                </a>
            </li>
            <li class="nav-item">
                <a href="/selections" class="nav-link active">
                    <span class="nav-icon">ğŸ“</span>
                    Selections
                </a>
            </li>
            <li class="nav-item">
                <a href="/import" class="nav-link">
                    <span class="nav-icon">ğŸ“¥</span>
                    Import
                </a>
            </li>
            <li class="nav-item">
                <a href="/authors" class="nav-link">
                    <span class="nav-icon">ğŸ‘¥</span>
                    Fotografer
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Hero Section -->
            <section class="section text-center mb-4">
                <h1>ğŸ“ Selections</h1>
                <p>Organiser og filtrer bildene dine med smarte selections</p>
                
                <!-- Action Buttons -->
                <div class="grid grid-2 mt-3">
                    <button class="btn btn-primary" onclick="showCreateSelectionModal()">
                        â• Opprett Ny Selection
                    </button>
                    <button class="btn btn-secondary" onclick="showAlgorithmicModal()">
                        ğŸ¤– Algoritmiske Forslag
                    </button>
                </div>
            </section>

            <!-- Quick Filters -->
            <section class="section mb-4">
                <h2>ğŸ” Filtrering</h2>
                <div class="search-form">
                    <input type="text" id="selectionSearch" class="form-input" placeholder="SÃ¸k i selections..." onkeyup="filterSelections()">
                    
                    <label class="checkbox-label">
                        <input type="checkbox" id="showFavorites" onchange="filterSelections()">
                        Kun favoritter
                    </label>
                    
                    <label class="checkbox-label">
                        <input type="checkbox" id="showAlgorithmic" checked onchange="filterSelections()">
                        Inkluder algoritmiske
                    </label>
                    
                    <select id="sortOrder" class="form-input" onchange="sortSelections()">
                        <option value="name">SortÃ©r etter navn</option>
                        <option value="created">Nyeste fÃ¸rst</option>
                        <option value="accessed">Sist brukt</option>
                        <option value="count">Flest bilder</option>
                    </select>
                </div>
            </section>

            <!-- Selections Grid -->
            <section class="section">
                <h2>ğŸ“‚ Mine Selections</h2>
                <div class="selections-grid" id="selectionsGrid">
                    <div class="loading-placeholder">
                        <div class="spinner"></div>
                        <p>Laster selections...</p>
                    </div>
                </div>
            </section>

            <!-- Selection Results (Hidden by default) -->
            <section class="section" id="selectionResults" style="display: none;">
                <div class="results-header">
                    <h2 id="resultsTitle">ğŸ“Š Selection Resultater</h2>
                    <div class="results-info">
                        <span id="resultsCount" class="stat-badge">0 bilder</span>
                        <span id="executionTime" class="stat-badge">0ms</span>
                        <button class="btn btn-secondary" onclick="closeSelectionResults()">âœ• Lukk</button>
                    </div>
                </div>
                <div class="results-grid" id="resultsGrid">
                    <!-- Results will be populated here -->
                </div>
                <div class="pagination-controls" id="paginationControls">
                    <!-- Pagination will be populated here -->
                </div>
            </section>
        </div>
    </main>

    <!-- Create/Edit Selection Modal -->
    <div class="modal" id="selectionModal" style="display: none;">
        <div class="modal-content selection-modal">
            <div class="modal-header">
                <h3 id="modalTitle">âœ¨ Opprett Ny Selection</h3>
                <button class="close-modal" onclick="closeSelectionModal()">âœ•</button>
            </div>
            
            <form id="selectionForm" class="selection-form">
                <!-- Basic Information -->
                <div class="section mb-3">
                    <h4>ğŸ“ Grunnleggende informasjon</h4>
                    
                    <div class="form-group">
                        <label for="selectionName">Navn*</label>
                        <input type="text" id="selectionName" class="form-input" required placeholder="F.eks. Familiebilder 2024">
                    </div>
                    
                    <div class="form-group">
                        <label for="selectionDescription">Beskrivelse</label>
                        <textarea id="selectionDescription" class="form-input" rows="3" placeholder="Beskriv hva denne selectionen inneholder..."></textarea>
                    </div>
                    
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label for="selectionColor">ğŸ¨ Farge</label>
                            <input type="color" id="selectionColor" class="form-input" value="#3498db">
                        </div>
                        <div class="form-group">
                            <label for="selectionIcon">ğŸ·ï¸ Ikon</label>
                            <select id="selectionIcon" class="form-input">
                                <option value="">Velg ikon</option>
                                <option value="ğŸ“">ğŸ“ Mappe</option>
                                <option value="â­">â­ Favoritt</option>
                                <option value="ğŸ“…">ğŸ“… Dato</option>
                                <option value="ğŸ¯">ğŸ¯ MÃ¥lrettet</option>
                                <option value="ğŸ·ï¸">ğŸ·ï¸ Tagg</option>
                                <option value="ğŸ’">ğŸ’ Premium</option>
                                <option value="ğŸš€">ğŸš€ Rask</option>
                                <option value="ğŸ¨">ğŸ¨ Kreativ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Selection Type Choice -->
                <div class="section mb-3">
                    <h4>ğŸ¤– Selection Type</h4>
                    
                    <div class="grid grid-2">
                        <div class="card" onclick="setSelectionType(false)">
                            <div class="card-icon">ğŸ”</div>
                            <h5>Kriteriebasert</h5>
                            <p>Bruk spesifikke sÃ¸keparametre</p>
                            <input type="radio" name="selectionType" value="manual" checked>
                        </div>
                        <div class="card" onclick="setSelectionType(true)">
                            <div class="card-icon">ğŸ¤–</div>
                            <h5>Algoritmisk</h5>
                            <p>Automatisk generert</p>
                            <input type="radio" name="selectionType" value="algorithmic">
                        </div>
                    </div>
                </div>

                <!-- Cascading Selection -->
                <div class="section mb-3">
                    <h4>ğŸ”— Kaskadescection (Valgfritt)</h4>
                    <p class="help-text mb-2">
                        Bygg pÃ¥ en eksisterende selection for Ã¥ innskrenke sÃ¸ket ytterligere.
                    </p>
                    
                    <div class="form-group">
                        <label for="parentSelection">BasÃ©r pÃ¥ selection</label>
                        <select id="parentSelection" class="form-input">
                            <option value="">ğŸŒŸ Start fra alle bilder</option>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                </div>

                <!-- Search Criteria (shown for manual selections) -->
                <div class="section mb-3" id="searchCriteriaSection">
                    <h4>ğŸ” SÃ¸keparametre</h4>
                    
                    <div class="grid grid-2 mb-3">
                        <div class="form-group">
                            <label for="dateFrom">ğŸ“… Fra dato</label>
                            <input type="date" id="dateFrom" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="dateTo">ğŸ“… Til dato</label>
                            <input type="date" id="dateTo" class="form-input">
                        </div>
                    </div>
                    
                    <div class="grid grid-2 mb-3">
                        <div class="form-group">
                            <label for="minRating">â­ Min rating</label>
                            <select id="minRating" class="form-input">
                                <option value="">Alle ratings</option>
                                <option value="1">â­ 1+ stjerner</option>
                                <option value="2">â­â­ 2+ stjerner</option>
                                <option value="3">â­â­â­ 3+ stjerner</option>
                                <option value="4">â­â­â­â­ 4+ stjerner</option>
                                <option value="5">â­â­â­â­â­ 5 stjerner</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="authorFilter">ğŸ‘¤ Fotograf</label>
                            <select id="authorFilter" class="form-input">
                                <option value="">Alle fotografer</option>
                                <!-- Will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group mb-3">
                        <label for="imageIds">ğŸ”¢ Spesifikke bilde-IDer</label>
                        <textarea id="imageIds" class="form-input" rows="2" placeholder="1,2,3,4... (kommaseparert)"></textarea>
                        <small class="help-text">For manuell selection av spesifikke bilder</small>
                    </div>

                    <div class="form-group">
                        <label for="searchCriteriaRaw">âš™ï¸ Avanserte parametre (JSON)</label>
                        <textarea id="searchCriteriaRaw" class="form-input" rows="4" placeholder='{"location": "stue", "tag": "familie", "min_size": 1000000}'></textarea>
                        <small class="help-text">For avanserte brukere: JSON-format for komplekse sÃ¸k</small>
                    </div>
                </div>

                <!-- Algorithmic Parameters (shown for algorithmic selections) -->
                <div class="section mb-3" id="algorithmicSection" style="display: none;">
                    <h4>ğŸ¤– Algoritme-innstillinger</h4>
                    
                    <div class="form-group mb-3">
                        <label for="algorithmType">Algoritme Type</label>
                        <select id="algorithmType" class="form-input">
                            <option value="">Velg algoritme</option>
                            <option value="similar">ğŸ” Lignende bilder</option>
                            <option value="quality">ğŸ’ HÃ¸y kvalitet</option>
                            <option value="popular">ğŸ“ˆ PopulÃ¦re</option>
                            <option value="recent">ğŸ†• Nylige</option>
                            <option value="diversity">ğŸ¨ Mangfold</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="algorithmParams">âš™ï¸ Algoritme-parametre (JSON)</label>
                        <textarea id="algorithmParams" class="form-input" rows="4" placeholder='{"threshold": 0.8, "limit": 100, "quality_min": 0.7}'></textarea>
                        <small class="help-text">Juster algoritme-innstillinger for bedre resultater</small>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeSelectionModal()">
                        âŒ Avbryt
                    </button>
                    <button type="submit" class="btn btn-primary">
                        ğŸ’¾ Opprett Selection
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <p id="loadingMessage">Arbeider...</p>
        </div>
    </div>

    <!-- Algorithmic Previews Modal -->
    <div class="modal" id="algorithmicModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ¤– Algoritmiske Forslag</h3>
                <button class="close-modal" onclick="closeAlgorithmicModal()">âœ•</button>
            </div>
            <div class="algorithmic-previews" id="algorithmicPreviews">
                <div class="loading-placeholder">
                    <div class="spinner"></div>
                    <p>Genererer intelligente forslag...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/selections.js?v=2000"></script>

    <script>
        // Enhanced selection type toggle
        function setSelectionType(isAlgorithmic) {
            const searchSection = document.getElementById('searchCriteriaSection');
            const algorithmicSection = document.getElementById('algorithmicSection');
            const radioButtons = document.querySelectorAll('input[name="selectionType"]');
            
            if (isAlgorithmic) {
                searchSection.style.display = 'none';
                algorithmicSection.style.display = 'block';
                radioButtons[1].checked = true;
            } else {
                searchSection.style.display = 'block';
                algorithmicSection.style.display = 'none';
                radioButtons[0].checked = true;
            }
            
            // Update form for JavaScript
            document.getElementById('isAlgorithmic').checked = isAlgorithmic;
        }
        
        // Initialize with manual selection
        document.addEventListener('DOMContentLoaded', function() {
            setSelectionType(false);
        });
    </script>
</body>
</html>