<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery Test - ImaLink</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>üß™ Gallery Modal Test</h1>
        
        <!-- Test Controls -->
        <div class="section">
            <button onclick="testModal()" class="btn btn-primary">Test Modal Open</button>
            <button onclick="testImageClick()" class="btn btn-secondary">Test Image Click</button>
        </div>
        
        <!-- Test Gallery -->
        <div class="section">
            <h2>Test Gallery</h2>
            <div class="gallery-grid">
                <div class="gallery-item">
                    <div class="thumbnail-container">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjZjBmMGYwIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgZmlsbD0iIzk5OTk5OSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0cHgiPlRlc3QgSW1hZ2U8L3RleHQ+Cjwvc3ZnPgo=" 
                             alt="test image"
                             title="Klikk for √• √•pne bildeviewer - testbilde.jpg"
                             onclick="console.log('Image clicked: test'); showImageModal('test');"
                             style="cursor: pointer;">
                        <div class="thumbnail-controls">
                            <button class="rotate-thumbnail-btn" onclick="event.stopPropagation(); alert('Rotate clicked')" title="Roter 90¬∞">
                                üîÑ
                            </button>
                        </div>
                    </div>
                    <div class="image-info">
                        <div class="image-filename" title="testbilde.jpg">
                            testbilde.jpg
                        </div>
                        <div class="image-meta">
                            <div class="image-date">
                                01.10.2025
                            </div>
                            <div class="image-size">
                                1200√ó800
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Image Viewer Modal -->
    <div id="imageModal" class="modal hidden">
        <div class="modal-content image-viewer">
            <div class="viewer-header">
                <h3 id="viewerTitle">Bildevisning</h3>
                <button class="close" onclick="closeModal()" title="Lukk">&times;</button>
            </div>
            
            <div class="viewer-controls">
                <div class="size-controls">
                    <label for="poolSizeSelector">St√∏rrelse:</label>
                    <select id="poolSizeSelector" class="form-select" onchange="onPoolSizeChange()">
                        <option value="small">Liten (400px)</option>
                        <option value="medium" selected>Medium (800px)</option>
                        <option value="large">Stor (1200px)</option>
                    </select>
                </div>
                
                <div class="action-controls">
                    <button id="viewerRotateBtn" class="btn btn-primary" onclick="rotateViewerImage()" title="Roter 90¬∞">
                        üîÑ Roter
                    </button>
                    <button id="viewerDownloadBtn" class="btn btn-secondary" onclick="downloadViewerImage()" title="Last ned pool-bilde">
                        üíæ Last ned
                    </button>
                </div>
            </div>
            
            <div class="viewer-body">
                <div class="image-container" id="viewerImageContainer">
                    <div id="imageLoadingSpinner" class="loading hidden">Laster bilde...</div>
                    <div id="imageError" class="error-message hidden">
                        Kunne ikke laste bilde. Pr√∏v en annen st√∏rrelse.
                    </div>
                </div>
                
                <div class="image-info-panel">
                    <h4>üìã Filinformasjon</h4>
                    <div id="imageFileInfo" class="image-details">
                        <!-- Details will be populated here -->
                    </div>
                    
                    <h4>üìä Tekniske detaljer</h4>
                    <div id="imageTechnicalInfo" class="image-technical">
                        <!-- Technical details will be populated here -->
                    </div>
                    
                    <h4>üìç Metadata</h4>
                    <div id="imageMetadataInfo" class="image-metadata">
                        <!-- Metadata will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock API base for testing
        const API_BASE = '';
        
        // Mock current image data
        let currentImageId = null;
        let currentImageData = null;

        // Test functions
        function testModal() {
            console.log('Testing modal...');
            const modal = document.getElementById('imageModal');
            if (modal) {
                console.log('Modal found, showing...');
                modal.classList.remove('hidden');
                
                // Add test content
                document.getElementById('viewerTitle').textContent = 'Test Modal';
                document.getElementById('viewerImageContainer').innerHTML = '<div style="padding: 2rem; text-align: center; color: #2d3748;"><h3>Modal fungerer! üéâ</h3><p>Alle elementer lastet riktig.</p></div>';
                
                // Populate test info
                populateTestInfo();
            } else {
                console.error('Modal element not found!');
                alert('Modal element not found in HTML!');
            }
        }

        function testImageClick() {
            console.log('Testing image click...');
            showImageModal('test-123');
        }

        function populateTestInfo() {
            document.getElementById('imageFileInfo').innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">Filnavn</span>
                    <span class="detail-value highlight">testbilde.jpg</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Filsti</span>
                    <span class="detail-value">C:/temp/testbilder/testbilde.jpg</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Filst√∏rrelse</span>
                    <span class="detail-value">2.5 MB</span>
                </div>
            `;
            
            document.getElementById('imageTechnicalInfo').innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">Format</span>
                    <span class="detail-value highlight">JPEG</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Oppl√∏sning</span>
                    <span class="detail-value">1200 √ó 800</span>
                </div>
            `;
            
            document.getElementById('imageMetadataInfo').innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">Tatt dato</span>
                    <span class="detail-value">01.10.2025 14:30</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Kamera</span>
                    <span class="detail-value">Canon EOS R5</span>
                </div>
            `;
        }

        // Mock modal functions
        function showImageModal(imageId) {
            console.log('showImageModal called with:', imageId);
            currentImageId = imageId;
            
            const modal = document.getElementById('imageModal');
            if (!modal) {
                console.error('Modal not found!');
                return;
            }
            
            modal.classList.remove('hidden');
            document.getElementById('viewerTitle').textContent = `Test Bilde (ID: ${imageId})`;
            document.getElementById('viewerImageContainer').innerHTML = `
                <div style="padding: 2rem; text-align: center; color: #2d3748;">
                    <h3>Bilde klikket! üñºÔ∏è</h3>
                    <p>Image ID: ${imageId}</p>
                    <p>Modal √•pnet via bildefunksjon</p>
                </div>
            `;
            populateTestInfo();
        }

        function closeModal() {
            console.log('Closing modal');
            const modal = document.getElementById('imageModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        function onPoolSizeChange() {
            const size = document.getElementById('poolSizeSelector').value;
            console.log('Pool size changed to:', size);
            alert(`Pool st√∏rrelse endret til: ${size}`);
        }

        function rotateViewerImage() {
            console.log('Rotate clicked');
            alert('Rotering ville blitt utf√∏rt her');
        }

        function downloadViewerImage() {
            console.log('Download clicked');
            alert('Nedlasting ville blitt startet her');
        }

        // Close modal on click outside
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // ESC key handler
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        console.log('Test page loaded. Click test buttons or the gallery image.');
    </script>
</body>
</html>