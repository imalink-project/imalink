# Test Examples

This directory contains example tests demonstrating best practices for ImaLink backend testing.

## Files

### `test_real_photoegg_usage.py`

Examples showing how to use **real PhotoEgg fixtures** generated by imalink-core.

**Key concepts:**
- Load pre-generated PhotoEggs with `load_photoegg(BASIC)`
- Use real hothashes, base64 previews, and metadata
- Test what frontend ACTUALLY sends
- Compare with old mock-based approach

**Quick example:**
```python
from tests.fixtures.real_photo_eggs import load_photoegg, BASIC

def test_create_photo(client, auth_headers):
    photoegg = load_photoegg(BASIC)  # Real PhotoEgg from imalink-core!
    
    response = client.post(
        "/api/v1/photos/new-photo",
        json=photoegg,
        headers=auth_headers
    )
    
    assert response.status_code == 201
    assert response.json()["hothash"] == photoegg["hothash"]
```

## Running Examples

```bash
# Run all example tests
uv run pytest tests/examples/ -v

# Run specific example
uv run pytest tests/examples/test_real_photoegg_usage.py -v
```

## Why Real PhotoEggs?

### Before (Mock Data)
```python
mock_photoegg = {
    "hothash": "a" * 64,  # Fake
    "hotpreview_base64": "fake",  # Not real JPEG
    "width": 800,
    "height": 600
}
```
❌ Doesn't match reality  
❌ Fake hashes and data  
❌ Can't test real JPEG decoding  
❌ Brittle when schema changes  

### After (Real PhotoEggs)
```python
photoegg = load_photoegg(BASIC)
# Real SHA256 hash from imalink-core
# Real base64-encoded JPEG preview
# Real dimensions from actual image
```
✅ Matches what frontend sends  
✅ Tests real data  
✅ Tests JPEG decoding  
✅ Contract testing with imalink-core  

## Available Fixtures

See `tests/fixtures/photo_eggs/README.md` for complete list.

Common fixtures:
- `BASIC` - Standard JPEG with EXIF
- `LANDSCAPE` - Landscape orientation
- `TINY` - Very small image (100x100)
- `FUJI_WITH_COLDPREVIEW` - Both hot and cold previews

## Regenerating Fixtures

If PhotoEgg schema changes in imalink-core:

```bash
# 1. Start imalink-core service
cd ~/imalink-core
uv run python -m service.main

# 2. Generate new fixtures
cd ~/imalink
uv run python scripts/generate_photoegg_fixtures.py
```

## See Also

- `tests/fixtures/photo_eggs/` - Pre-generated PhotoEgg JSON files
- `tests/fixtures/real_photo_eggs.py` - Loader utility functions
- `scripts/generate_photoegg_fixtures.py` - Generator script
- `docs/CONTRACTS.md` - PhotoEgg specification
